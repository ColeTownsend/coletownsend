!function(e,d){var f=function(h,g,j){var i;return function(){function a(){j||h.apply(c,b),i=null}var c=this,b=arguments;i?clearTimeout(i):j&&h.apply(c,b),i=setTimeout(a,g||100)}};jQuery.fn[d]=function(b){return b?this.bind("resize",f(b)):this.trigger(d)}}(jQuery,"smartresize");!function(b){b.fn.fluidbox=function(v){var u=b.extend(!0,{viewportFill:0.95,overlayColor:"rgba(255,255,255,.85)",debounceResize:!0,stackIndex:1000,stackIndexDelta:10,closeTrigger:[{selector:".fluidbox-overlay",event:"click"},{selector:"document",event:"keyup",keyCode:27}]},v);u.stackIndex<u.stackIndexDelta&&(u.stackIndexDelta=u.stackIndex),$fbOverlay=b("<div />",{"class":"fluidbox-overlay",css:{"background-color":u.overlayColor,"z-index":u.stackIndex}});var r,t=this,s=b(window),q=function(){b(".fluidbox-opened").trigger("click")},p=function(h){var e=h.find("img"),l=h.find(".fluidbox-ghost"),k=s.scrollTop()-e.offset().top+0.5*e.data("imgHeight")*(e.data("imgScale")-1)+0.5*(s.height()-e.data("imgHeight")*e.data("imgScale")),j=0.5*e.data("imgWidth")*(e.data("imgScale")-1)+0.5*(s.width()-e.data("imgWidth")*e.data("imgScale"))-e.offset().left,i=e.data("imgScale");l.css({transform:"translate("+parseInt(10*j)/10+"px,"+parseInt(10*k)/10+"px) scale("+parseInt(1000*i)/1000+")"})},o=function(){t.each(function(){n(b(this))})},n=function(e){if(r=s.width()/s.height(),e.hasClass("fluidbox")){var c=e.find("img"),j=e.find(".fluidbox-ghost"),i=e.find(".fluidbox-wrap"),f=c.data();f.imgWidth=c.width(),f.imgHeight=c.height(),f.imgRatio=c.width()/c.height(),j.css({width:c.width(),height:c.height(),top:c.offset().top-i.offset().top,left:c.offset().left-i.offset().left}),f.imgScale=r>f.imgRatio?s.height()*u.viewportFill/c.height():s.width()*u.viewportFill/c.width()}},m=function(c){if(b(this).hasClass("fluidbox")){var w=b(this),l=b(this).find("img"),k=b(this).find(".fluidbox-ghost"),j=b(this).find(".fluidbox-wrap"),h={};0!==b(this).data("fluidbox-state")&&b(this).data("fluidbox-state")?(w.data("fluidbox-state",0).removeClass("fluidbox-opened").addClass("fluidbox-closed"),h.open&&window.clearTimeout(h.open),h.close=window.setTimeout(function(){b(".fluidbox-overlay").remove(),j.css({"z-index":u.stackIndex-u.stackIndexDelta})},10),b(".fluidbox-overlay").css({opacity:0}),k.css({transform:"translate(0,0) scale(1)"}).one("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd transitionEnd",function(){l.css({opacity:1}),h.hideGhost=window.setTimeout(function(){k.css({opacity:0})},250)})):b("<img />",{src:l.attr("src")}).load(function(){w.append($fbOverlay).data("fluidbox-state",1).removeClass("fluidbox-closed").addClass("fluidbox-opened"),h.close&&window.clearTimeout(h.close),h.hideGhost&&window.clearTimeout(h.hideGhost),h.open=window.setTimeout(function(){b(".fluidbox-overlay").css({opacity:1})},10),j.css({"z-index":u.stackIndex+u.stackIndexDelta}),k.off("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd transitionEnd").css({"background-image":"url("+l.attr("src")+")",opacity:1}),l.css({opacity:0});var d=new Image;d.onload=function(){k.css({"background-image":"url("+w.attr("href")+")"})},d.src=w.attr("href"),p(w)}),c.preventDefault()}};u.closeTrigger&&b.each(u.closeTrigger,function(c){var e=u.closeTrigger[c];"window"!=e.selector?"document"==e.selector?e.keyCode?b(document).on(e.event,function(d){d.keyCode==e.keyCode&&q()}):b(document).on(e.event,q):b(document).on(e.event,u.closeTrigger[c].selector,q):s.on(e.event,q)}),t.each(function(){if(b(this).is("a")&&1===b(this).children().length&&b(this).children().is("img")){var f=b("<div />",{"class":"fluidbox-wrap",css:{"z-index":u.stackIndex-u.stackIndexDelta}}),c=b(this);c.addClass("fluidbox").wrapInner(f).find("img").css({opacity:1}).after('<div class="fluidbox-ghost" />').each(function(){var d=b(this);d.width()>0&&d.height()>0?(n(c),c.click(m)):d.load(function(){n(c),c.click(m)})})}});var a=function(){o();var c=b("a.fluidbox.fluidbox-opened");c.length>0&&p(c)};return u.debounceResize?b(window).smartresize(a):b(window).resize(a),t}}(jQuery);