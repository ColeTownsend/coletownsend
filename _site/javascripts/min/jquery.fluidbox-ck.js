!function(c,b){var a=function(g,f,d){var h;return function j(){function k(){d||g.apply(e,i),h=null}var e=this,i=arguments;h?clearTimeout(h):d&&g.apply(e,i),h=setTimeout(k,f||100)}};jQuery.fn[b]=function(d){return d?this.bind("resize",a(d)):this.trigger(b)}}(jQuery,"smartresize"),function(a){a.fn.fluidbox=function(u){var j=a.extend(!0,{viewportFill:0.8,overlayColor:"rgba(35,40,48,.85)",debounceResize:!0,stackIndex:1000,stackIndexDelta:10,closeTrigger:[{selector:".fluidbox-overlay",event:"click"},{selector:"document",event:"keyup",keyCode:27}]},u);j.stackIndex<j.stackIndexDelta&&(j.stackIndexDelta=j.stackIndex),$fbOverlay=a("<div />",{"class":"fluidbox-overlay",css:{"background-color":j.overlayColor,"z-index":j.stackIndex}});var e=this,g=a(window),q,v=function(){a(".fluidbox-opened").trigger("click")},m=function(n){var f=n.find("img"),d=n.find(".fluidbox-ghost"),r=g.scrollTop()-f.offset().top+0.5*f.data("imgHeight")*(f.data("imgScale")-1)+0.5*(g.height()-f.data("imgHeight")*f.data("imgScale")),c=0.5*f.data("imgWidth")*(f.data("imgScale")-1)+0.5*(g.width()-f.data("imgWidth")*f.data("imgScale"))-f.offset().left,l=f.data("imgScale");d.css({transform:"translate("+parseInt(10*c)/10+"px,"+parseInt(10*r)/10+"px) scale("+parseInt(1000*l)/1000+")"})},p=function(){e.each(function(){b(a(this))})},b=function(i){if(q=g.width()/g.height(),i.hasClass("fluidbox")){var c=i.find("img"),n=i.find(".fluidbox-ghost"),f=i.find(".fluidbox-wrap"),l=c.data();l.imgWidth=c.width(),l.imgHeight=c.height(),l.imgRatio=c.width()/c.height(),n.css({width:c.width(),height:c.height(),top:c.offset().top-f.offset().top,left:c.offset().left-f.offset().left}),l.imgScale=q>l.imgRatio?g.height()*j.viewportFill/c.height():g.width()*j.viewportFill/c.width()}},h=function(f){if(a(this).hasClass("fluidbox")){var l=a(this),w=a(this).find("img"),d=a(this).find(".fluidbox-ghost"),i=a(this).find(".fluidbox-wrap"),r={};0!==a(this).data("fluidbox-state")&&a(this).data("fluidbox-state")?(l.data("fluidbox-state",0).removeClass("fluidbox-opened").addClass("fluidbox-closed"),r.open&&window.clearTimeout(r.open),r.close=window.setTimeout(function(){a(".fluidbox-overlay").remove(),i.css({"z-index":j.stackIndex-j.stackIndexDelta})},10),a(".fluidbox-overlay").css({opacity:0}),d.css({transform:"translate(0,0) scale(1)"}).one("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd transitionEnd",function(){w.css({opacity:1}),r.hideGhost=window.setTimeout(function(){d.css({opacity:0})},250)})):a("<img />",{src:w.attr("src")}).load(function(){l.append($fbOverlay).data("fluidbox-state",1).removeClass("fluidbox-closed").addClass("fluidbox-opened"),r.close&&window.clearTimeout(r.close),r.hideGhost&&window.clearTimeout(r.hideGhost),r.open=window.setTimeout(function(){a(".fluidbox-overlay").css({opacity:1})},10),i.css({"z-index":j.stackIndex+j.stackIndexDelta}),d.off("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd transitionEnd").css({"background-image":"url("+w.attr("src")+")",opacity:1}),w.css({opacity:0});var c=new Image;c.onload=function(){d.css({"background-image":"url("+l.attr("href")+")"})},c.src=l.attr("href"),m(l)}),f.preventDefault()}};j.closeTrigger&&a.each(j.closeTrigger,function(c){var d=j.closeTrigger[c];"window"!=d.selector?"document"==d.selector?d.keyCode?a(document).on(d.event,function(f){f.keyCode==d.keyCode&&v()}):a(document).on(d.event,v):a(document).on(d.event,j.closeTrigger[c].selector,v):g.on(d.event,v)}),e.each(function(c){if(a(this).is("a")&&1===a(this).children().length&&a(this).children().is("img")){var d=a("<div />",{"class":"fluidbox-wrap",css:{"z-index":j.stackIndex-j.stackIndexDelta}}),f=a(this);f.addClass("fluidbox").wrapInner(d).find("img").css({opacity:1}).after('<div class="fluidbox-ghost" />').each(function(){var i=a(this);i.width()>0&&i.height()>0?(b(f),f.click(h)):i.load(function(){b(f),f.click(h)})})}});var k=function(){p();var c=a("a.fluidbox.fluidbox-opened");c.length>0&&m(c)};return j.debounceResize?a(window).smartresize(k):a(window).resize(k),e}}(jQuery);