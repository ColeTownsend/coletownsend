!function(e,t){var i=function(e,t,i){var o;return function n(){function n(){i||e.apply(a,s),o=null}var a=this,s=arguments;o?clearTimeout(o):i&&e.apply(a,s),o=setTimeout(n,t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",i(e)):this.trigger(t)}}(jQuery,"smartresize"),function(e){e.fn.fluidbox=function(t){var i=e.extend(!0,{viewportFill:.8,overlayColor:"rgba(35,40,48,.85)",debounceResize:!0,stackIndex:1e3,stackIndexDelta:10,closeTrigger:[{selector:".fluidbox-overlay",event:"click"},{selector:"document",event:"keyup",keyCode:27}]},t);i.stackIndex<i.stackIndexDelta&&(i.stackIndexDelta=i.stackIndex),$fbOverlay=e("<div />",{"class":"fluidbox-overlay",css:{"background-color":i.overlayColor,"z-index":i.stackIndex}});var o=this,n=e(window),a,s=function(){e(".fluidbox-opened").trigger("click")},d=function(e){var t=e.find("img"),i=e.find(".fluidbox-ghost"),o=n.scrollTop()-t.offset().top+.5*t.data("imgHeight")*(t.data("imgScale")-1)+.5*(n.height()-t.data("imgHeight")*t.data("imgScale")),a=.5*t.data("imgWidth")*(t.data("imgScale")-1)+.5*(n.width()-t.data("imgWidth")*t.data("imgScale"))-t.offset().left,s=t.data("imgScale");i.css({transform:"translate("+parseInt(10*a)/10+"px,"+parseInt(10*o)/10+"px) scale("+parseInt(1e3*s)/1e3+")"})},c=function(){o.each(function(){r(e(this))})},r=function(e){if(a=n.width()/n.height(),e.hasClass("fluidbox")){var t=e.find("img"),o=e.find(".fluidbox-ghost"),s=e.find(".fluidbox-wrap"),d=t.data();d.imgWidth=t.width(),d.imgHeight=t.height(),d.imgRatio=t.width()/t.height(),o.css({width:t.width(),height:t.height(),top:t.offset().top-s.offset().top,left:t.offset().left-s.offset().left}),d.imgScale=a>d.imgRatio?n.height()*i.viewportFill/t.height():n.width()*i.viewportFill/t.width()}},l=function(t){if(e(this).hasClass("fluidbox")){var o=e(this),n=e(this).find("img"),a=e(this).find(".fluidbox-ghost"),s=e(this).find(".fluidbox-wrap"),c={};0!==e(this).data("fluidbox-state")&&e(this).data("fluidbox-state")?(o.data("fluidbox-state",0).removeClass("fluidbox-opened").addClass("fluidbox-closed"),c.open&&window.clearTimeout(c.open),c.close=window.setTimeout(function(){e(".fluidbox-overlay").remove(),s.css({"z-index":i.stackIndex-i.stackIndexDelta})},10),e(".fluidbox-overlay").css({opacity:0}),a.css({transform:"translate(0,0) scale(1)"}).one("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd transitionEnd",function(){n.css({opacity:1}),c.hideGhost=window.setTimeout(function(){a.css({opacity:0})},250)})):e("<img />",{src:n.attr("src")}).load(function(){o.append($fbOverlay).data("fluidbox-state",1).removeClass("fluidbox-closed").addClass("fluidbox-opened"),c.close&&window.clearTimeout(c.close),c.hideGhost&&window.clearTimeout(c.hideGhost),c.open=window.setTimeout(function(){e(".fluidbox-overlay").css({opacity:1})},10),s.css({"z-index":i.stackIndex+i.stackIndexDelta}),a.off("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd transitionEnd").css({"background-image":"url("+n.attr("src")+")",opacity:1}),n.css({opacity:0});var t=new Image;t.onload=function(){a.css({"background-image":"url("+o.attr("href")+")"})},t.src=o.attr("href"),d(o)}),t.preventDefault()}};i.closeTrigger&&e.each(i.closeTrigger,function(t){var o=i.closeTrigger[t];"window"!=o.selector?"document"==o.selector?o.keyCode?e(document).on(o.event,function(e){e.keyCode==o.keyCode&&s()}):e(document).on(o.event,s):e(document).on(o.event,i.closeTrigger[t].selector,s):n.on(o.event,s)}),o.each(function(t){if(e(this).is("a")&&1===e(this).children().length&&e(this).children().is("img")){var o=e("<div />",{"class":"fluidbox-wrap",css:{"z-index":i.stackIndex-i.stackIndexDelta}}),n=e(this);n.addClass("fluidbox").wrapInner(o).find("img").css({opacity:1}).after('<div class="fluidbox-ghost" />').each(function(){var t=e(this);t.width()>0&&t.height()>0?(r(n),n.click(l)):t.load(function(){r(n),n.click(l)})})}});var f=function(){c();var t=e("a.fluidbox.fluidbox-opened");t.length>0&&d(t)};return i.debounceResize?e(window).smartresize(f):e(window).resize(f),o}}(jQuery);